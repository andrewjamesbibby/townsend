## Laravel Code Refactor 

## Task
* Refactor legacy sectionProducts() method into modern Laravel.
* Create route entry at /products and /products/section

## Setup 
* Install by cloning this repository and running ````composer install````
* Copy the .env.example to .env and setup enter credentials for local DB.
* Run ```php artisan key:generate``` to create application key.
* Run ```php artisan serve``` to create a local server to view the application.
* Finally seed the database with ```php artisan db:seed``` to populate the database with data

## Routes

There are 4 routes available to show all products or products by section. Legacy routes show output generated by the original sectionProducts() method. Other routes return refactored Laravel paginated responses.

* /products
* /products/{section}
* /legacy/products
* /legacy/products/{section}

## Query Parameters
The following query parameters can be sent with each GET request.

* per_page | specify the number of results to return per page e.g 10
* page | The page number to return e.g 6
* sort | The sort order of results. Options: az, za, low, high, old, new 

## Tests
* This project includes a series of tests which were used to confirm output.
* To run the tests first ensure that you have a 'townsend_test' database (or configure an alternative in phpunit.xml)
* Run the tests with ```php artisan test```

## Points to note / discuss
* Code reuse with methods extracted to query scopes and traits where possible.
* Responses have been paginated which is best practise when dealing with json result sets. 
* Responses are passed through Laravel resources class for data presentation.
* Eager loading used to avoid the n+1 issues in legacy methods.
* Model factories have been created to supply tests with data.
* There was double '//' in the original response for images. This is removed in the new output.
* Ordering by name e.g AZ, ZA is performed on the 'name' column as expected - however presentation logic can use the display name which could be different depending on its length and appear broken depending on the data being used.
* Ordering by price doesn't account for changes in currency because it occurs on the 'price' column - (although likely this will still work as they will probably be in the same pricing scale). 
* The 'deleted' column would perhaps be better altered to deleted_at to provide soft deletes and/or and audit of when a particular product was removed.
* Not sure why valid images are determined by image_format > 2 - seems a really odd check to make (better to validate against list of supported valid image types)
* Disabled countries column would be better as a json column to allow for easier filtering or linked in another table.


